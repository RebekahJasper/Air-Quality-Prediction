# -*- coding: utf-8 -*-
"""Untitled30.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1EoANgnjfBAR51yaNlmA-1GFYzTuHeD7R
"""

!pip install streamlit
!pip install --upgrade prophet cmdstanpy
import streamlit as st
import pandas as pd
import numpy as np
from prophet import Prophet
import plotly.express as px
import plotly.graph_objects as go # Import plotly.graph_objects
from sklearn.metrics import mean_absolute_error, mean_squared_error, r2_score

st.title('Air Quality Prediction Dashboard')
# Corrected URL to raw CSV data
df = pd.read_csv('https://raw.githubusercontent.com/RebekahJasper/Air-Quality-Prediction/main/air_pollution_data.csv')
df['datetime'] = pd.to_datetime(df['date'], format='%d-%m-%Y')
df_prophet = df[['datetime', 'aqi']].rename(columns={'datetime': 'ds', 'aqi': 'y'})

# Sidebar for future period selection using st.sidebar.slider
periods = st.sidebar.slider("Days to Forecast Ahead", min_value=3, max_value=30, value=7)

# Prophet modeling
model = Prophet()
model.fit(df_prophet)
future = model.make_future_dataframe(periods=periods, freq='D') # Use selected periods
forecast = model.predict(future)

# Plotting with plotly.graph_objects
fig = go.Figure() # Initialize an empty figure object
fig.add_trace(go.Scatter(x=df_prophet['ds'], y=df_prophet['y'], mode='lines', name='Actual AQI'))
fig.add_trace(go.Scatter(x=forecast['ds'], y=forecast['yhat'], mode='lines', name='Predicted AQI'))
fig.update_layout(title='AQI Forecast', xaxis_title='Date', yaxis_title='AQI')
st.plotly_chart(fig, width='stretch') # Updated use_container_width to width='stretch'

# Metrics on last forecasted period
st.subheader('Model Performance(Last Forecasted Days)')
# Ensure y_true and y_pred have the same length for accurate metric calculation
# Selecting the last 'periods' actual values if available, otherwise adjust
y_true = df_prophet['y'].tail(periods) # Use periods from sidebar
# Match the forecast values to the corresponding actual dates if possible
# For simplification, we'll take the last 'periods' of the forecast as well
y_pred = forecast['yhat'].tail(periods)

# If df_prophet does not have enough historical data to match 'periods' from forecast
# for error calculation, then adjust y_true to match the overlapping dates.
# For now, assuming the last 'periods' of actual data aligns with the forecast.

mae = mean_absolute_error(y_true, y_pred)
rmse = np.sqrt(mean_squared_error(y_true, y_pred))
r2 = r2_score(y_true, y_pred) # Renamed to avoid conflict with imported r2_score function
st.write(f"MAE: {mae:.2f}")
st.write(f"RMSE: {rmse:.2f}")
st.write(f"R2 Score: {r2:.2f}")